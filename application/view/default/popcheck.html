<!--{eval global $starttime,$querynum;$mtime = explode(' ', microtime());$runtime=number_format($mtime[1] + $mtime[0] - $starttime,6); $setting=$this->setting;$user=$this->user;$headernavlist=$this->nav;$regular=$this->regular;}-->
<link href="{SITE_URL}static/css/dist/css/zui.min.css" rel="stylesheet">
<div class="poploginform">

 <div id="user_error" class="alert alert-danger hide">

 </div>
    <form  class="form-horizontal" name="loginform"   method="post"    >

         <div class="form-group">
          <label class="col-md-2 control-label">身份确认</label>
          <div class="col-md-2">
              <label>
             <input type="radio" id="chanzhong" class="normal_radio" name="shenfen" value="1" <!--{if (1 == $user['identity'])}--> checked <!--{/if}--> />
              产中
              </label>
          </div>
          <div class="col-md-2">
              <label>
                  <input type="radio" id="guwen" class="normal_radio" name="shenfen" value="2" <!--{if (2 == $user['identity'])}--> checked <!--{/if}--> />
                 非产中
              </label>
          </div>
        </div>
           <div class="form-group">
          <label class="col-md-2 control-label">邮箱认证</label>
          <div class="col-md-5">
             <input  type="email"  id="popemail" name="popemail" value="{$user['email']}" placeholder="输入邮箱账号" class="form-control">
              <div class="text-danger font-18 bold" style="font-size: 14px;">
                  {if $user['active']==0}
                  请激活邮箱
                  {else}
                  邮箱已经激活,可不验证
                  {/if}
              </div>
              <div  id="emailtip" class="help-block alert alert-warning hide" style="margin-bottom:0px"></div>
          </div>
               <div class="col-md-2">
                   <input type="button" id="submitCode" onclick="sendcode();" class="btn btn-danger width-120" value="发送验证码">
               </div>
        </div>

                <div class="form-group">
          <label class="col-md-2 control-label">输入验证码</label>
          <div class="col-md-5">
             <input type="text"  id="emailcode" name="emailcode"  value="" class="form-control">

          </div>

        </div>

         <div class="form-group">
          <div class="col-md-offset-2 col-md-10">
             <input type="button" onclick="checkform();" id="submit" class="btn btn-danger width-120" value="认证" data-loading="稍候...">
            <input type="hidden" id="popforward" name="forward" value="{$forward}"/>
          </div>
        </div>
    </form>

    <script type="text/javascript">
//        var temp = true;
//        function check(id) {
//            if(!temp) {
//                temp = true;
//                var ischeck = id.checked;
//                console.log(ischeck);
//                if (ischeck === true) {
//                    id.checked = !ischeck;
//                } else {
//                }
//            }else{
//                temp = false;
//            }
//        }
        function sendcode() {
//            $("#emailtip").html("").removeClass("hide");
//            $("#emailtip").html("").addClass("hide");
            $("#emailtip").empty();
            var popemail = $("#popemail").val();
            if ($.trim(popemail) === '') {
                new $.zui.Messager("请输入您的邮箱", {
                    type: 'danger',
                    time:"1000",
                    close: true,
                    placement: 'center' // 定义显示位置
                }).show();

                $("#popemail").focus();
                return false;
            }
            $.ajax({
                type: "POST",
                async: false,
                cache: false,

                //提交的网址
                url:"{SITE_URL}/?user/sendemailcode",
                //提交的数据
                data:{email:$.trim(popemail)},
                //返回数据的格式
                datatype: "text",//"xml", "html", "script", "json", "jsonp", "text".

                success: function(data) {
                    data=$.trim(data);
                    $("#emailtip").html("").removeClass("hide");
                    $("#emailtip").empty();
                    $("#emailtip").append(data);
//                    new $.zui.Messager(data, {
//                        type: 'info',
//                        close: true,
//                        time:"3000",
//                        placement: 'center' // 定义显示位置
//                    }).show();
                }
            });
            return false;
            if (!$("#user_error").hasClass("hide")) {
                return false;
            } else {
                return true;
            }
        }
        function checkform() {
            var chanzhong = $("#chanzhong").is(':checked');
            var guwen = $("#guwen").is(':checked');
            var popemail = $("#popemail").val();
            var emailcode = $("#emailcode").val();
            var _forward = $("#popforward").val();

            if (chanzhong === false && guwen === false) {
                new $.zui.Messager("请选择您的身份", {
                    type: 'danger',
                    close: true,
                    time: "3000",
                    placement: 'center' // 定义显示位置
                }).show();
                $("#chanzhong").focus();
                return false;
            }
            $("#user_error").html("").addClass("hide");
            var identity = 0;
            if (chanzhong == true) {
                identity = 1;
            }
            if (guwen == true) {
                identity = 2;
            }
            $.ajax({
                type: "POST",
                async: false,
                cache: false,
                //提交的网址
                url: "{SITE_URL}/?user/emailcheck",
                //提交的数据
                data: {email: $.trim(popemail), activecode: $.trim(emailcode), identity: identity},
                //返回数据的格式
                datatype: "text",//"xml", "html", "script", "json", "jsonp", "text".
                success: function (data) {
                    data = $.trim(data);
                    if (data == 'activation successful') {
                        window.location.href = _forward;
                    } else {
                        new $.zui.Messager(data, {
                            type: 'danger',
                            close: true,
                            time: "3000",
                            placement: 'center' // 定义显示位置
                        }).show();
                        return false;
                    }
                }
            })
            if (!$("#user_error").hasClass("hide")) {
                return false;
            } else {
                return true;
            }
        }

    </script>

</div>
<style>
label{
    color: #333;
    font-family: 'Microsoft YaHei';
    font-size: 14px;
}
</style>